<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Television</title>

<link rel="manifest" href="./manifest.webmanifest">
<link rel="icon" type="image/png" href="./icon-192.png">
<link rel="apple-touch-icon" href="./icon-192.png">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Television">

<style>
:root{--pink:#ff2ea6}
html,body{margin:0;height:100%;background:#000;overflow:hidden}
#container{position:relative;width:100%;height:100%}
video{width:100%;height:100%;object-fit:cover;background:#000}

#startOverlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:20}
#startBtn{
  width:40vh;height:40vh;max-width:420px;max-height:420px;
  min-width:220px;min-height:220px;
  background:#fff;border:14px solid var(--pink);
  border-radius:50%;cursor:pointer;
  display:flex;align-items:center;justify-content:center
}
#startBtn:active{transform:scale(.98)}
#startBtn:before{
  content:"";
  margin-left:18px;
  width:0;height:0;
  border-top:60px solid transparent;
  border-bottom:60px solid transparent;
  border-left:96px solid #000;
}

#loading{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  display:none;flex-direction:column;align-items:center;gap:18px;
  color:var(--pink);font:900 clamp(24px,4vw,48px)/1.2 system-ui,Arial;
  z-index:10;pointer-events:none;text-align:center
}
.spinner{
  width:60px;height:60px;border:8px solid rgba(255,46,166,.25);
  border-top-color:var(--pink);border-radius:50%;
  animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}

#title{
  position:absolute;top:24px;left:50%;transform:translateX(-50%);
  color:var(--pink);font:900 clamp(28px,5vw,64px)/1.2 system-ui,Arial;
  display:none;z-index:9;pointer-events:none;white-space:nowrap
}

.controls.hidden{display:none !important;}

.nav{
  position:absolute;top:50%;transform:translateY(-50%);
  width:20vh;height:20vh;min-width:96px;min-height:96px;
  background:#fff;border:10px solid var(--pink);
  border-radius:18px;cursor:pointer;z-index:8;
  display:flex;align-items:center;justify-content:center;
}
.nav::before{
  font-family:system-ui,Arial,sans-serif;
  font-weight:900;
  font-size:clamp(72px,10vh,160px);
  color:#000;line-height:1;
}
#prev{left:24px} #prev::before{content:"◀";}
#next{right:24px} #next::before{content:"▶";}

#home{
  position:absolute;top:18px;right:18px;width:96px;height:96px;
  background:#fff;border:10px solid var(--pink);
  border-radius:18px;cursor:pointer;z-index:9;
  display:flex;align-items:center;justify-content:center
}
#home svg{width:78%;height:78%}
</style>
</head>
<body>
<div id="container">
  <video id="video" playsinline></video>

  <div id="startOverlay"><button id="startBtn" aria-label="Play"></button></div>

  <div id="title"></div>
  <div id="loading"><div>Loading / טוען</div><div class="spinner"></div></div>

  <button id="prev" class="nav controls hidden" aria-label="Previous channel"></button>
  <button id="next" class="nav controls hidden" aria-label="Next channel"></button>

  <button id="home" class="controls hidden" aria-label="Home">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path fill="#000" d="M12 3.2 2.5 11.2c-.3.3-.5.7-.5 1.1 0 .8.6 1.4 1.4 1.4H5v7.1c0 .7.6 1.3 1.3 1.3h3.9v-5.6h3.6v5.6h3.9c.7 0 1.3-.6 1.3-1.3v-7.1h1.6c.8 0 1.4-.6 1.4-1.4 0-.4-.2-.8-.5-1.1L12 3.2z"/>
    </svg>
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const M3U_TEXT = `#EXTM3U
#EXTINF:-1 tvg-id="i24NEWSHebrew.il@SD",i24NEWS Hebrew
https://bcovlive-a.akamaihd.net/d89ede8094c741b7924120b27764153c/eu-central-1/5377161796001/profile_0/chunklist.m3u8

#EXTINF:-1 tvg-id="Kan11.il@SD",Kan 11 Israel (1080p)
https://kan11w.media.kan.org.il/hls/live/2105694/2105694/master.m3u8

#EXTINF:-1 tvg-id="Channel13.il@SD",Reshet 13 (720p)
https://d2xg1g9o5vns8m.cloudfront.net/out/v1/0855d703f7d5436fae6a9c7ce8ca5075/index.m3u8

#EXTINF:-1 tvg-id="Hidabroot.il@SD",Hidabroot (1080p)
https://cdn.cybercdn.live/HidabrootIL/Live97/playlist.m3u8

#EXTINF:-1 tvg-id="ShelanuTV.il@SD",Shelanu TV (720p)
https://1247634592.rsc.cdn77.org/1247634592/playlist.m3u8

#EXTINF:-1 tvg-id="KabbalahforthePeopleIsrael.il@SD",Kabbalah La'Am (Israel) (540p) [Not 24/7]
https://edge3.uk.kab.tv/live/tv66-heb-high/playlist.m3u8

#EXTINF:-1 group-title="News",SABC NEWS
https://sabconetanw.cdn.mangomolo.com/news/smil:news.stream.smil/chunklist_b1600000_t64NzIwcA==.m3u8

#EXTINF:-1 group-title="News",CNN
https://turnerlive.warnermediacdn.com/hls/live/586495/cnngo/cnn_slate/VIDEO_0_3564000.m3u8

#EXTINF:-1 group-title="News",Sky News International
https://linear417-gb-hls1-prd-ak.cdn.skycdp.com/100e/Content/HLS_001_1080_30/Live/channel(skynews)/index_1080-30.m3u8

#EXTINF:-1 group-title="News",BBC News
https://d1kvlt93j1bc49.cloudfront.net/v1/master/3722c60a815c199d9c0ef36c5b73da68a62b09d1/cc-6vpx7bvwjm7ao/v1/amcnetworks_bbcnews_1/samsungheadend_us/latest/main/hls/playlist.m3u8

#EXTINF:-1 group-title="Documentary" tvg-id="BBCEarth.uk@US",BBC Earth (1080p)
https://amg00793-amg00793c6-xumo-us-2669.playouts.now.amagi.tv/BBCStudios-BBCEarthA-hls/playlist.m3u8

#EXTINF:-1 group-title="Documentary" tvg-id="WildEarth.uk@SD",WildEarth (1080p)
https://wildearth-ono.amagi.tv/playlist/amg01290-wildearth-oando/playlist.m3u8

#EXTINF:-1 group-title="Documentary" tvg-id="AntiquesRoadshowUK.us@SD",Antiques Roadshow UK (1080p)
https://bbc-antiquesroadshowuk-1-us.roku.wurl.tv/playlist.m3u8
`;

function parseM3U(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0);
  const channels = [];
  for(let i=0;i<lines.length;i++) {
    const line = lines[i];
    if(line.startsWith("#EXTINF")) {
      const comma = line.indexOf(",");
      const name = comma >= 0 ? line.slice(comma+1).trim() : "Channel";
      let j = i+1;
      while(j < lines.length && lines[j].startsWith("#")) j++;
      const url = (j < lines.length) ? lines[j].trim() : "";
      if(url && !url.startsWith("#")) channels.push({name, url});
    }
  }
  return channels;
}

const channels = parseM3U(M3U_TEXT);
let idx = 0;

const v = document.getElementById("video");
const title = document.getElementById("title");
const load = document.getElementById("loading");
const overlay = document.getElementById("startOverlay");
const startBtn = document.getElementById("startBtn");
const container = document.getElementById("container");

const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const homeBtn = document.getElementById("home");
const controlEls = document.querySelectorAll(".controls");

let hls = null;

function showLoad(on) {
  load.style.display = on ? "flex" : "none";
  title.style.display = on ? "block" : "none";
}

function showControls(on) {
  controlEls.forEach(el => el.classList.toggle("hidden", !on));
}

function destroyHls() {
  if(hls) {
    try { hls.destroy(); } catch(e) {}
    hls = null;
  }
}

function playChannel(i) {
  if(!channels.length) return;
  idx = (i + channels.length) % channels.length;
  const ch = channels[idx];
  title.textContent = ch.name.replace(/\s*\([^)]*\)/g, '').trim();
  showLoad(true);

  destroyHls();
  try { v.pause(); } catch(e) {}
  try { v.removeAttribute("src"); v.load(); } catch(e) {}

  if(window.Hls && Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(ch.url);
    hls.attachMedia(v);

    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      v.play().catch(()=>{});
    });
    hls.on(Hls.Events.FRAG_LOADED, () => {
      showLoad(false);
    });
    hls.on(Hls.Events.ERROR, (evt, data) => {
      if(data && data.fatal) {
        showLoad(true);
      }
    });
  } else {
    v.src = ch.url;
    v.oncanplay = () => {
      v.play().catch(()=>{});
      showLoad(false);
    };
  }
}

startBtn.onclick = async () => {
  overlay.style.display = "none";
  showControls(true);

  v.muted = false;
  try { await container.requestFullscreen(); } catch(e) {}

  playChannel(0);
};

prevBtn.onclick = () => playChannel(idx - 1);
nextBtn.onclick = () => playChannel(idx + 1);

homeBtn.onclick = () => {
  try { v.pause(); } catch(e) {}
  destroyHls();
  window.close();
  setTimeout(() => { try { window.open("about:blank","_self"); } catch(e) {} }, 50);
};

showControls(false);
</script>

<script>
  // PWA: register service worker (requires HTTPS or localhost)
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    });
  }
</script>

</body>
</html>
